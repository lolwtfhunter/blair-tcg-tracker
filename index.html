<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blair Master Set Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #e63946;
            --secondary: #ffcc00;
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --text: #f1f1f1;
            --text-dim: #a0a0a0;
            --accent-blue: #4c9aff;
            --accent-green: #00ff88;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            padding: 15px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(230, 57, 70, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 90% 80%, rgba(76, 154, 255, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 25px 20px;
            background: var(--gradient);
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            letter-spacing: -1px;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-card);
            border-radius: 12px;
        }

        .controls-row {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .set-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            width: 100%;
        }

        .set-btn {
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .set-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .set-btn.active {
            background: var(--primary);
            border-color: var(--secondary);
            box-shadow: 0 4px 15px rgba(230, 57, 70, 0.4);
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: rgba(255, 255, 255, 0.15);
        }

        input[type="text"]::placeholder {
            color: var(--text-dim);
        }

        .progress-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .progress-card {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .progress-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 6px;
            margin-bottom: 30px;
        }

        .card-item {
            background: var(--bg-card);
            border-radius: 6px;
            padding: 6px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .card-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border-color: var(--accent-blue);
        }

        .card-item.all-collected {
            border-color: var(--accent-green);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(76, 154, 255, 0.1));
        }

        .card-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            margin-bottom: 5px;
            text-align: center;
        }

        .card-img {
            width: 55px;
            height: 77px;
            background: linear-gradient(135deg, #3b4cca 0%, #b13589 50%, #ffcc00 100%);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            border: 2px solid #ffcc00;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        
        .card-img::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
        }
        
        .card-img.loading {
            background: var(--gradient);
        }

        .card-img.loading::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 255, 255, 0.1) 50%, 
                transparent 70%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0%, 100% { transform: translateX(-100%) translateY(-100%); }
            50% { transform: translateX(100%) translateY(100%); }
        }

        .card-info {
            flex: 1;
            min-width: 0;
            width: 100%;
        }

        .card-number {
            font-weight: 700;
            color: var(--secondary);
            font-size: 0.65rem;
            margin-bottom: 2px;
        }

        .card-name {
            font-weight: 600;
            font-size: 0.7rem;
            margin-bottom: 3px;
            color: var(--text);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.1;
            min-height: 1.5rem;
        }

        .rarity-badge {
            display: inline-block;
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 0.5rem;
            font-weight: 600;
        }

        .rarity-common { background: #6c757d; }
        .rarity-uncommon { background: #28a745; }
        .rarity-rare { background: #ffc107; }
        .rarity-ex { background: var(--primary); }
        .rarity-secret { background: var(--gradient); }
        .rarity-trainer { background: #17a2b8; }

        .variants-section {
            margin-top: 4px;
            padding-top: 4px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .variants-title {
            font-size: 0.5rem;
            font-weight: 600;
            margin-bottom: 3px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.2px;
        }

        .variant-checkboxes {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .variant-checkbox {
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 2px 3px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .variant-checkbox:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .variant-checkbox.checked {
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid var(--accent-green);
        }

        .variant-checkbox input[type="checkbox"] {
            width: 12px;
            height: 12px;
            cursor: pointer;
            accent-color: var(--accent-green);
            flex-shrink: 0;
        }

        .variant-checkbox label {
            flex: 1;
            cursor: pointer;
            font-size: 0.55rem;
            user-select: none;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .variant-icon {
            font-size: 0.65rem;
            flex-shrink: 0;
        }

        /* Single variant style */
        .single-variant {
            padding: 3px 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 3px;
            cursor: pointer;
        }

        .single-variant:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .single-variant.checked {
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid var(--accent-green);
        }

        .single-variant input[type="checkbox"] {
            width: 14px;
            height: 14px;
            cursor: pointer;
            accent-color: var(--accent-green);
            flex-shrink: 0;
        }

        .single-variant label {
            flex: 1;
            cursor: pointer;
            font-size: 0.6rem;
            font-weight: 600;
            user-select: none;
        }

        .set-section {
            display: none;
        }

        .set-section.active {
            display: block;
        }

        .export-btn {
            padding: 10px 18px;
            background: var(--accent-green);
            color: var(--bg-dark);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .controls {
                flex-direction: column;
            }

            .card-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .card-header {
                flex-direction: column;
            }
            
            .card-img {
                width: 50px;
                height: 70px;
            }
        }

        @media (max-width: 400px) {
            .card-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card-img {
                width: 55px;
                height: 77px;
            }
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-dim);
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° Blair Master Set Tracker ‚ö°</h1>
            <p class="subtitle">Track every variant of your Journey Together, Destined Rivals, Prismatic Evolutions & Phantasmal Flames collections</p>
        </header>

        <div class="controls">
            <div class="set-selector">
                <button class="set-btn active" data-set="journey-together">Journey Together</button>
                <button class="set-btn" data-set="destined-rivals">Destined Rivals</button>
                <button class="set-btn" data-set="prismatic-evolutions">Prismatic Evolutions</button>
                <button class="set-btn" data-set="phantasmal-flames">Phantasmal Flames</button>
            </div>
            <div class="controls-row">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç Search by name or number...">
                </div>
                <button class="export-btn" onclick="exportProgress()">üìä Export Progress</button>
            </div>
        </div>

        <div class="progress-section" id="progressSection"></div>

        <div id="journey-together" class="set-section active">
            <div class="card-grid" id="journey-together-grid"></div>
        </div>

        <div id="destined-rivals" class="set-section">
            <div class="card-grid" id="destined-rivals-grid"></div>
        </div>

        <div id="prismatic-evolutions" class="set-section">
            <div class="card-grid" id="prismatic-evolutions-grid"></div>
        </div>

        <div id="phantasmal-flames" class="set-section">
            <div class="card-grid" id="phantasmal-flames-grid"></div>
        </div>

        <footer>
            Made with ‚ù§Ô∏è for Pok√©mon TCG collectors | Track each variant separately | Your progress saves automatically
        </footer>
    </div>

    <script>
        // Image cache
        const imageCache = {};

        // Function to determine variants based on set and card properties
        const getVariants = (card, setKey) => {
            const setData = cardSets[setKey];
            
            // Journey Together variant rules
            if (setKey === 'journey-together') {
                // EX cards and Secret Rares are single variant
                if (card.rarity === 'ex' || card.rarity === 'secret') {
                    return ['single'];
                }
                // All other cards (common, uncommon, rare, trainer) have Regular + Reverse Holo
                return ['regular', 'reverse-holo'];
            }
            
            // Prismatic Evolutions variant rules
            if (setKey === 'prismatic-evolutions') {
                // EX cards and Secret Rares are single variant
                if (card.rarity === 'ex' || card.rarity === 'secret') {
                    return ['single'];
                }
                // Trainer cards: Regular + Reverse Holo + Pok√© Ball (NO Master Ball)
                if (card.type === 'trainer') {
                    return ['regular', 'reverse-holo', 'pokeball'];
                }
                // Pok√©mon cards (common/uncommon/rare): Regular + Reverse Holo + Pok√© Ball + Master Ball
                return ['regular', 'reverse-holo', 'pokeball', 'masterball'];
            }
            
            // Default for other sets (Destined Rivals, Phantasmal Flames)
            if (card.rarity === 'ex' || card.rarity === 'secret') {
                return ['single'];
            }
            return ['regular', 'reverse-holo'];
        };

        const variantLabels = {
            'single': { label: 'Collected', icon: '‚úì' },
            'regular': { label: 'Regular', icon: '‚ö™' },
            'reverse-holo': { label: 'Reverse Holo', icon: '‚ú®' },
            'holo': { label: 'Holo', icon: 'üíé' },
            'pokeball': { label: 'Pok√© Ball', icon: '‚öæ' },
            'masterball': { label: 'Master Ball', icon: 'üîÆ' }
        };

        // Function to get multiple possible image URLs for a card
        function getCardImageUrls(setCode, cardNumber) {
            const num = String(cardNumber);
            const paddedNum = num.padStart(3, '0');
            
            const setMappings = {
                'sv09': { code: 'SV9', alt: 'sv9', name: 'journey-together' },
                'sv08': { code: 'SV8', alt: 'sv8', name: 'destined-rivals' },
                'sv07': { code: 'SV7', alt: 'sv7', name: 'prismatic-evolutions' },
                'sv06pt5': { code: 'SV6pt5', alt: 'sv6pt5', name: 'phantasmal-flames' }
            };
            
            const mapping = setMappings[setCode];
            if (!mapping) return [];
            
            return [
                // Limitlesstcg - most reliable for new sets
                `https://limitlesstcg.nyc3.cdn.digitaloceanspaces.com/tpci/${mapping.code}/${mapping.code}_EN_${num}.png`,
                // Pokemon TCG API
                `https://images.pokemontcg.io/${mapping.alt}/${num}.png`,
                // Alternative Pokemon TCG API with padding
                `https://images.pokemontcg.io/${mapping.alt}/${paddedNum}.png`,
                // Serebii backup
                `https://www.serebii.net/card/${mapping.code.toLowerCase()}/${paddedNum}.jpg`
            ];
        }

        // Load image with multiple source fallback
        function loadCardImage(imgElement, setCode, cardNumber, cardName) {
            const cacheKey = `${setCode}-${cardNumber}`;
            
            // Check cache first
            if (imageCache[cacheKey]) {
                imgElement.src = imageCache[cacheKey];
                imgElement.style.display = 'block';
                imgElement.parentElement.classList.remove('loading');
                return;
            }

            const urls = getCardImageUrls(setCode, cardNumber);
            let currentIndex = 0;

            function tryNextUrl() {
                if (currentIndex >= urls.length) {
                    // All URLs failed - keep placeholder
                    imgElement.parentElement.classList.remove('loading');
                    return;
                }

                const testImage = new Image();
                testImage.crossOrigin = 'anonymous';
                
                testImage.onload = function() {
                    // Success! Use this URL
                    imageCache[cacheKey] = urls[currentIndex];
                    imgElement.src = urls[currentIndex];
                    imgElement.style.display = 'block';
                    imgElement.parentElement.classList.remove('loading');
                };
                
                testImage.onerror = function() {
                    // This URL failed, try next
                    currentIndex++;
                    tryNextUrl();
                };
                
                testImage.src = urls[currentIndex];
            }

            tryNextUrl();
        }

        // Card data for each set
        const cardSets = {
            'journey-together': {
                name: 'Journey Together',
                totalCards: 190,
                mainSet: 180,
                setCode: 'sv09',
                cards: [
                    {number: 1, name: 'Caterpie', rarity: 'common', type: 'pokemon'},
                    {number: 2, name: 'Metapod', rarity: 'common', type: 'pokemon'},
                    {number: 3, name: 'Butterfree', rarity: 'uncommon', type: 'pokemon'},
                    {number: 4, name: 'Paras', rarity: 'common', type: 'pokemon'},
                    {number: 5, name: 'Parasect', rarity: 'uncommon', type: 'pokemon'},
                    {number: 6, name: 'Petilil', rarity: 'common', type: 'pokemon'},
                    {number: 7, name: 'Lilligant', rarity: 'uncommon', type: 'pokemon'},
                    {number: 8, name: 'Maractus', rarity: 'common', type: 'pokemon'},
                    {number: 9, name: 'Karrablast', rarity: 'common', type: 'pokemon'},
                    {number: 10, name: 'Foongus', rarity: 'common', type: 'pokemon'},
                    {number: 11, name: 'Amoonguss ex', rarity: 'ex', type: 'pokemon'},
                    {number: 12, name: 'Shelmet', rarity: 'common', type: 'pokemon'},
                    {number: 13, name: 'Accelgor', rarity: 'uncommon', type: 'pokemon'},
                    {number: 14, name: 'Durant', rarity: 'common', type: 'pokemon'},
                    {number: 15, name: 'Virizion', rarity: 'rare', type: 'pokemon'},
                    {number: 16, name: 'Sprigatito', rarity: 'common', type: 'pokemon'},
                    {number: 17, name: 'Floragato', rarity: 'common', type: 'pokemon'},
                    {number: 18, name: 'Meowscarada', rarity: 'uncommon', type: 'pokemon'},
                    {number: 19, name: 'Nymble', rarity: 'common', type: 'pokemon'},
                    {number: 20, name: 'Magmar', rarity: 'common', type: 'pokemon'},
                    {number: 21, name: 'Magmortar', rarity: 'uncommon', type: 'pokemon'},
                    {number: 22, name: 'Torchic', rarity: 'common', type: 'pokemon'},
                    {number: 23, name: 'Combusken', rarity: 'common', type: 'pokemon'},
                    {number: 24, name: 'Blaziken ex', rarity: 'ex', type: 'pokemon'},
                    {number: 25, name: 'Torkoal', rarity: 'common', type: 'pokemon'},
                    {number: 26, name: "N's Darumaka", rarity: 'common', type: 'pokemon'},
                    {number: 27, name: "N's Darmanitan", rarity: 'uncommon', type: 'pokemon'},
                    {number: 28, name: 'Larvesta', rarity: 'common', type: 'pokemon'},
                    {number: 29, name: 'Volcarona', rarity: 'uncommon', type: 'pokemon'},
                    {number: 30, name: 'Reshiram ex', rarity: 'ex', type: 'pokemon'},
                    {number: 31, name: 'Volcanion ex', rarity: 'ex', type: 'pokemon'},
                    {number: 32, name: 'Articuno', rarity: 'rare', type: 'pokemon'},
                    {number: 33, name: 'Remoraid', rarity: 'common', type: 'pokemon'},
                    {number: 34, name: 'Octillery', rarity: 'uncommon', type: 'pokemon'},
                    {number: 35, name: 'Lotad', rarity: 'common', type: 'pokemon'},
                    {number: 36, name: 'Lombre', rarity: 'common', type: 'pokemon'},
                    {number: 37, name: 'Ludicolo', rarity: 'uncommon', type: 'pokemon'},
                    {number: 38, name: 'Wingull', rarity: 'common', type: 'pokemon'},
                    {number: 39, name: 'Pelipper', rarity: 'uncommon', type: 'pokemon'},
                    {number: 40, name: 'Wailmer', rarity: 'common', type: 'pokemon'},
                    {number: 41, name: 'Wailord', rarity: 'uncommon', type: 'pokemon'},
                    {number: 42, name: 'Regice', rarity: 'rare', type: 'pokemon'},
                    {number: 43, name: 'Veluza ex', rarity: 'ex', type: 'pokemon'},
                    {number: 44, name: 'Alolan Geodude', rarity: 'common', type: 'pokemon'},
                    {number: 45, name: 'Alolan Graveler', rarity: 'common', type: 'pokemon'},
                    {number: 46, name: 'Alolan Golem', rarity: 'uncommon', type: 'pokemon'},
                    {number: 47, name: "Iono's Voltorb", rarity: 'common', type: 'pokemon'},
                    {number: 48, name: "Iono's Electrode", rarity: 'uncommon', type: 'pokemon'},
                    {number: 49, name: "N's Joltik", rarity: 'common', type: 'pokemon'},
                    {number: 50, name: 'Togedemaru', rarity: 'common', type: 'pokemon'},
                    {number: 51, name: 'Tapu Koko ex', rarity: 'ex', type: 'pokemon'},
                    {number: 52, name: "Iono's Tadbulb", rarity: 'common', type: 'pokemon'},
                    {number: 53, name: "Iono's Bellibolt ex", rarity: 'ex', type: 'pokemon'},
                    {number: 54, name: "Iono's Wattrel", rarity: 'common', type: 'pokemon'},
                    {number: 55, name: "Iono's Kilowattrel", rarity: 'uncommon', type: 'pokemon'},
                    {number: 56, name: "Lillie's Clefairy ex", rarity: 'ex', type: 'pokemon'},
                    {number: 57, name: 'Alolan Marowak', rarity: 'uncommon', type: 'pokemon'},
                    {number: 58, name: 'Mr. Mime', rarity: 'common', type: 'pokemon'},
                    {number: 59, name: 'Shuppet', rarity: 'common', type: 'pokemon'},
                    {number: 60, name: 'Banette', rarity: 'uncommon', type: 'pokemon'},
                    {number: 61, name: 'Beldum', rarity: 'common', type: 'pokemon'},
                    {number: 62, name: 'Metang', rarity: 'common', type: 'pokemon'},
                    {number: 63, name: 'Metagross', rarity: 'uncommon', type: 'pokemon'},
                    {number: 64, name: "N's Sigilyph", rarity: 'common', type: 'pokemon'},
                    {number: 65, name: 'Oricorio', rarity: 'common', type: 'pokemon'},
                    {number: 66, name: "Lillie's Cutiefly", rarity: 'common', type: 'pokemon'},
                    {number: 67, name: "Lillie's Ribombee", rarity: 'uncommon', type: 'pokemon'},
                    {number: 68, name: "Lillie's Comfey", rarity: 'common', type: 'pokemon'},
                    {number: 69, name: 'Mimikyu ex', rarity: 'ex', type: 'pokemon'},
                    {number: 70, name: 'Dhelmise', rarity: 'common', type: 'pokemon'},
                    {number: 71, name: 'Impidimp', rarity: 'common', type: 'pokemon'},
                    {number: 72, name: 'Morgrem', rarity: 'common', type: 'pokemon'},
                    {number: 73, name: 'Grimmsnarl', rarity: 'uncommon', type: 'pokemon'},
                    {number: 74, name: 'Milcery', rarity: 'common', type: 'pokemon'},
                    {number: 75, name: 'Alcremie ex', rarity: 'ex', type: 'pokemon'},
                    {number: 76, name: 'Cubone', rarity: 'common', type: 'pokemon'},
                    {number: 77, name: 'Swinub', rarity: 'common', type: 'pokemon'},
                    {number: 78, name: 'Piloswine', rarity: 'common', type: 'pokemon'},
                    {number: 79, name: 'Mamoswine ex', rarity: 'ex', type: 'pokemon'},
                    {number: 80, name: 'Larvitar', rarity: 'common', type: 'pokemon'},
                    {number: 81, name: 'Pupitar', rarity: 'common', type: 'pokemon'},
                    {number: 82, name: 'Regirock', rarity: 'rare', type: 'pokemon'},
                    {number: 83, name: 'Pancham', rarity: 'common', type: 'pokemon'},
                    {number: 84, name: 'Rockruff', rarity: 'common', type: 'pokemon'},
                    {number: 85, name: 'Lycanroc', rarity: 'uncommon', type: 'pokemon'},
                    {number: 86, name: "Hop's Silicobra", rarity: 'common', type: 'pokemon'},
                    {number: 87, name: "Hop's Sandaconda", rarity: 'uncommon', type: 'pokemon'},
                    {number: 88, name: 'Toedscool', rarity: 'common', type: 'pokemon'},
                    {number: 89, name: 'Toedscruel', rarity: 'uncommon', type: 'pokemon'},
                    {number: 90, name: 'Klawf', rarity: 'common', type: 'pokemon'},
                    {number: 91, name: 'Koffing', rarity: 'common', type: 'pokemon'},
                    {number: 92, name: 'Weezing', rarity: 'uncommon', type: 'pokemon'},
                    {number: 93, name: 'Paldean Wooper', rarity: 'common', type: 'pokemon'},
                    {number: 94, name: 'Paldean Clodsire ex', rarity: 'ex', type: 'pokemon'},
                    {number: 95, name: 'Tyranitar', rarity: 'rare', type: 'pokemon'},
                    {number: 96, name: "N's Purrloin", rarity: 'common', type: 'pokemon'},
                    {number: 97, name: "N's Zorua", rarity: 'common', type: 'pokemon'},
                    {number: 98, name: "N's Zoroark ex", rarity: 'ex', type: 'pokemon'},
                    {number: 99, name: 'Pangoro', rarity: 'uncommon', type: 'pokemon'},
                    {number: 100, name: 'Lokix', rarity: 'uncommon', type: 'pokemon'},
                    {number: 101, name: 'Bombirdier', rarity: 'uncommon', type: 'pokemon'},
                    {number: 102, name: 'Escavalier', rarity: 'uncommon', type: 'pokemon'},
                    {number: 103, name: "N's Klink", rarity: 'common', type: 'pokemon'},
                    {number: 104, name: "N's Klang", rarity: 'common', type: 'pokemon'},
                    {number: 105, name: "N's Klinklang", rarity: 'uncommon', type: 'pokemon'},
                    {number: 106, name: 'Galarian Stunfisk', rarity: 'common', type: 'pokemon'},
                    {number: 107, name: 'Magearna', rarity: 'uncommon', type: 'pokemon'},
                    {number: 108, name: "Hop's Corviknight", rarity: 'uncommon', type: 'pokemon'},
                    {number: 109, name: 'Cufant', rarity: 'common', type: 'pokemon'},
                    {number: 110, name: 'Copperajah', rarity: 'uncommon', type: 'pokemon'},
                    {number: 111, name: "Hop's Zacian ex", rarity: 'ex', type: 'pokemon'},
                    {number: 112, name: 'Bagon', rarity: 'common', type: 'pokemon'},
                    {number: 113, name: 'Shelgon', rarity: 'common', type: 'pokemon'},
                    {number: 114, name: 'Salamence ex', rarity: 'ex', type: 'pokemon'},
                    {number: 115, name: 'Druddigon', rarity: 'common', type: 'pokemon'},
                    {number: 116, name: "N's Reshiram", rarity: 'rare', type: 'pokemon'},
                    {number: 117, name: "Hop's Snorlax", rarity: 'uncommon', type: 'pokemon'},
                    {number: 118, name: 'Sentret', rarity: 'common', type: 'pokemon'},
                    {number: 119, name: 'Furret', rarity: 'uncommon', type: 'pokemon'},
                    {number: 120, name: 'Dunsparce', rarity: 'common', type: 'pokemon'},
                    {number: 121, name: 'Dudunsparce ex', rarity: 'ex', type: 'pokemon'},
                    {number: 122, name: 'Kecleon', rarity: 'common', type: 'pokemon'},
                    {number: 123, name: 'Tropius', rarity: 'common', type: 'pokemon'},
                    {number: 124, name: 'Audino', rarity: 'common', type: 'pokemon'},
                    {number: 125, name: 'Minccino', rarity: 'common', type: 'pokemon'},
                    {number: 126, name: 'Cinccino', rarity: 'uncommon', type: 'pokemon'},
                    {number: 127, name: 'Noibat', rarity: 'common', type: 'pokemon'},
                    {number: 128, name: 'Noivern', rarity: 'uncommon', type: 'pokemon'},
                    {number: 129, name: 'Komala', rarity: 'common', type: 'pokemon'},
                    {number: 130, name: 'Drampa', rarity: 'uncommon', type: 'pokemon'},
                    {number: 131, name: 'Skwovet', rarity: 'common', type: 'pokemon'},
                    {number: 132, name: 'Greedent', rarity: 'uncommon', type: 'pokemon'},
                    {number: 133, name: "Hop's Rookidee", rarity: 'common', type: 'pokemon'},
                    {number: 134, name: "Hop's Corvisquire", rarity: 'common', type: 'pokemon'},
                    {number: 135, name: "Hop's Wooloo", rarity: 'common', type: 'pokemon'},
                    {number: 136, name: "Hop's Dubwool", rarity: 'uncommon', type: 'pokemon'},
                    {number: 137, name: 'Cramorant', rarity: 'common', type: 'pokemon'},
                    {number: 138, name: "Hop's Cramorant", rarity: 'common', type: 'pokemon'},
                    {number: 139, name: 'Lechonk', rarity: 'common', type: 'pokemon'},
                    {number: 140, name: 'Oinkologne', rarity: 'uncommon', type: 'pokemon'},
                    {number: 141, name: 'Squawkabilly', rarity: 'common', type: 'pokemon'},
                    {number: 142, name: "Billy and O'Nare", rarity: 'trainer', type: 'trainer'},
                    {number: 143, name: "Black Belt's Training", rarity: 'trainer', type: 'trainer'},
                    {number: 144, name: "Black Belt's Training", rarity: 'trainer', type: 'trainer'},
                    {number: 145, name: "Black Belt's Training", rarity: 'trainer', type: 'trainer'},
                    {number: 146, name: "Brock's Scouting", rarity: 'trainer', type: 'trainer'},
                    {number: 147, name: "Hop's Bag", rarity: 'trainer', type: 'trainer'},
                    {number: 148, name: "Hop's Choice Band", rarity: 'trainer', type: 'trainer'},
                    {number: 149, name: "Iris's Fighting Spirit", rarity: 'trainer', type: 'trainer'},
                    {number: 150, name: 'Levincia', rarity: 'trainer', type: 'trainer'},
                    {number: 151, name: "Lillie's Pearl", rarity: 'trainer', type: 'trainer'},
                    {number: 152, name: "N's Castle", rarity: 'trainer', type: 'trainer'},
                    {number: 153, name: "N's PP Up", rarity: 'trainer', type: 'trainer'},
                    {number: 154, name: 'Postwick', rarity: 'trainer', type: 'trainer'},
                    {number: 155, name: "Professor's Research", rarity: 'trainer', type: 'trainer'},
                    {number: 156, name: 'Redeemable Ticket', rarity: 'trainer', type: 'trainer'},
                    {number: 157, name: 'Ruffian', rarity: 'trainer', type: 'trainer'},
                    {number: 158, name: 'Super Potion', rarity: 'trainer', type: 'trainer'},
                    {number: 159, name: 'Spiky Energy', rarity: 'trainer', type: 'trainer'},
                    {number: 160, name: 'Maractus', rarity: 'rare', type: 'pokemon'},
                    {number: 161, name: 'Articuno', rarity: 'rare', type: 'pokemon'},
                    {number: 162, name: 'Wailord', rarity: 'rare', type: 'pokemon'},
                    {number: 163, name: "Iono's Kilowattrel", rarity: 'rare', type: 'pokemon'},
                    {number: 164, name: "Lillie's Ribombee", rarity: 'rare', type: 'pokemon'},
                    {number: 165, name: 'Swinub', rarity: 'rare', type: 'pokemon'},
                    {number: 166, name: 'Lycanroc', rarity: 'rare', type: 'pokemon'},
                    {number: 167, name: "N's Reshiram", rarity: 'rare', type: 'pokemon'},
                    {number: 168, name: 'Furret', rarity: 'rare', type: 'pokemon'},
                    {number: 169, name: 'Noibat', rarity: 'rare', type: 'pokemon'},
                    {number: 170, name: "Hop's Wooloo", rarity: 'rare', type: 'pokemon'},
                    {number: 171, name: 'Volcanion ex', rarity: 'secret', type: 'pokemon'},
                    {number: 172, name: "Iono's Bellibolt ex", rarity: 'secret', type: 'pokemon'},
                    {number: 173, name: "Lillie's Clefairy ex", rarity: 'secret', type: 'pokemon'},
                    {number: 174, name: 'Mamoswine ex', rarity: 'secret', type: 'pokemon'},
                    {number: 175, name: "N's Zoroark ex", rarity: 'secret', type: 'pokemon'},
                    {number: 176, name: "Hop's Zacian ex", rarity: 'secret', type: 'pokemon'},
                    {number: 177, name: 'Salamence ex', rarity: 'secret', type: 'pokemon'},
                    {number: 178, name: 'Dudunsparce ex', rarity: 'secret', type: 'pokemon'},
                    {number: 179, name: "Brock's Scouting", rarity: 'secret', type: 'trainer'},
                    {number: 180, name: "Iris's Fighting Spirit", rarity: 'secret', type: 'trainer'},
                    {number: 181, name: 'Ruffian', rarity: 'secret', type: 'trainer'},
                    {number: 182, name: 'Volcanion ex', rarity: 'secret', type: 'pokemon'},
                    {number: 183, name: "Iono's Bellibolt ex", rarity: 'secret', type: 'pokemon'},
                    {number: 184, name: "Lillie's Clefairy ex", rarity: 'secret', type: 'pokemon'},
                    {number: 185, name: "N's Zoroark ex", rarity: 'secret', type: 'pokemon'},
                    {number: 186, name: "Hop's Zacian ex", rarity: 'secret', type: 'pokemon'},
                    {number: 187, name: 'Salamence ex', rarity: 'secret', type: 'pokemon'},
                    {number: 188, name: "Iono's Bellibolt ex", rarity: 'secret', type: 'pokemon'},
                    {number: 189, name: "N's Zoroark ex", rarity: 'secret', type: 'pokemon'},
                    {number: 190, name: 'Spiky Energy', rarity: 'secret', type: 'trainer'}
                ]
            },
            'destined-rivals': {
                name: 'Destined Rivals',
                totalCards: 244,
                mainSet: 182,
                setCode: 'sv08',
                cards: Array.from({length: 244}, (_, i) => ({
                    number: i + 1,
                    name: `Card ${i + 1}`,
                    rarity: i < 182 ? (i < 100 ? 'common' : 'uncommon') : 'secret',
                    type: 'pokemon'
                }))
            },
            'prismatic-evolutions': {
                name: 'Prismatic Evolutions',
                totalCards: 180,
                mainSet: 131,
                setCode: 'sv07',
                cards: Array.from({length: 180}, (_, i) => ({
                    number: i + 1,
                    name: `Card ${i + 1}`,
                    rarity: i < 131 ? (i < 80 ? 'common' : 'uncommon') : 'secret',
                    type: 'pokemon'
                }))
            },
            'phantasmal-flames': {
                name: 'Phantasmal Flames',
                totalCards: 130,
                mainSet: 94,
                setCode: 'sv06pt5',
                cards: Array.from({length: 130}, (_, i) => ({
                    number: i + 1,
                    name: `Card ${i + 1}`,
                    rarity: i < 94 ? (i < 60 ? 'common' : 'uncommon') : 'secret',
                    type: 'pokemon'
                }))
            }
        };

        // Load saved progress
        function loadProgress() {
            const saved = localStorage.getItem('pokemonVariantProgress');
            return saved ? JSON.parse(saved) : {};
        }

        // Save progress
        function saveProgress(progress) {
            localStorage.setItem('pokemonVariantProgress', JSON.stringify(progress));
        }

        let collectionProgress = loadProgress();

        // Initialize collection progress for each set
        Object.keys(cardSets).forEach(setKey => {
            if (!collectionProgress[setKey]) {
                collectionProgress[setKey] = {};
            }
        });

        // Update progress bars
        function updateProgress() {
            const progressSection = document.getElementById('progressSection');
            progressSection.innerHTML = '';

            Object.entries(cardSets).forEach(([setKey, setData]) => {
                let totalVariants = 0;
                let collectedVariants = 0;

                setData.cards.forEach(card => {
                    const variants = getVariants(card, setKey);
                    totalVariants += variants.length;
                    
                    if (collectionProgress[setKey][card.number]) {
                        collectedVariants += Object.values(collectionProgress[setKey][card.number]).filter(Boolean).length;
                    }
                });

                const percentage = totalVariants > 0 ? Math.round((collectedVariants / totalVariants) * 100) : 0;

                const progressCard = document.createElement('div');
                progressCard.className = 'progress-card';
                progressCard.innerHTML = `
                    <h3>${setData.name}</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%">
                            ${percentage}%
                        </div>
                    </div>
                    <div class="stats">
                        <span>${collectedVariants} / ${totalVariants} variants</span>
                        <span>${totalVariants - collectedVariants} remaining</span>
                    </div>
                `;
                progressSection.appendChild(progressCard);
            });
        }

        // Render card grid
        function renderCards(setKey) {
            const gridId = setKey + '-grid';
            const grid = document.getElementById(gridId);
            if (!grid) {
                console.error('Grid not found:', gridId);
                return;
            }

            grid.innerHTML = '';
            const setData = cardSets[setKey];
            if (!setData) {
                console.error('Set data not found:', setKey);
                return;
            }

            setData.cards.forEach(card => {
                const variants = getVariants(card, setKey);
                const cardProgress = collectionProgress[setKey][card.number] || {};
                const allCollected = variants.every(v => cardProgress[v]);
                const isSingleVariant = variants.length === 1 && variants[0] === 'single';
                
                const isSecret = card.number > setData.mainSet;
                const cardEl = document.createElement('div');
                cardEl.className = `card-item ${allCollected ? 'all-collected' : ''}`;
                
                // Determine rarity badge class
                const rarityClass = card.type === 'trainer' ? 'rarity-trainer' : `rarity-${card.rarity}`;
                
                // Generate variant checkboxes
                let variantHTML = '';
                if (isSingleVariant) {
                    // Single checkbox for EX and Secret cards
                    const isChecked = cardProgress['single'] || false;
                    variantHTML = `
                        <div class="single-variant ${isChecked ? 'checked' : ''}" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                id="${setKey}-${card.number}-single"
                                ${isChecked ? 'checked' : ''} 
                                onchange="toggleVariant('${setKey}', ${card.number}, 'single')">
                            <label for="${setKey}-${card.number}-single}">
                                ‚úì Collected
                            </label>
                        </div>
                    `;
                } else {
                    // Multiple variant checkboxes
                    variantHTML = variants.map(variant => {
                        const isChecked = cardProgress[variant] || false;
                        const variantInfo = variantLabels[variant];
                        return `
                            <div class="variant-checkbox ${isChecked ? 'checked' : ''}" onclick="event.stopPropagation()">
                                <input type="checkbox" 
                                    id="${setKey}-${card.number}-${variant}"
                                    ${isChecked ? 'checked' : ''} 
                                    onchange="toggleVariant('${setKey}', ${card.number}, '${variant}')">
                                <label for="${setKey}-${card.number}-${variant}">
                                    <span class="variant-icon">${variantInfo.icon}</span>
                                    ${variantInfo.label}
                                </label>
                            </div>
                        `;
                    }).join('');
                }

                cardEl.innerHTML = `
                    <div class="card-header">
                        <div class="card-img loading" id="img-${setKey}-${card.number}">
                            <span style="position: relative; z-index: 1;">${isSecret ? '‚≠ê' : 'üé¥'}</span>
                        </div>
                        <div class="card-info">
                            <div class="card-number">#${String(card.number).padStart(3, '0')}${isSecret ? ` / ${setData.mainSet}` : ''}</div>
                            <div class="card-name">${card.name}</div>
                            <span class="rarity-badge ${rarityClass}">${card.type === 'trainer' ? 'TRAINER' : card.rarity.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="variants-section">
                        <div class="variants-title">${isSingleVariant ? 'STATUS:' : 'VARIANTS:'}</div>
                        ${isSingleVariant ? variantHTML : '<div class="variant-checkboxes">' + variantHTML + '</div>'}
                    </div>
                `;
                grid.appendChild(cardEl);
                
                // Load card image after adding to DOM
                const imgContainer = document.getElementById(`img-${setKey}-${card.number}`);
                if (imgContainer) {
                    const img = document.createElement('img');
                    imgContainer.appendChild(img);
                    // Delay image loading slightly to improve initial render performance
                    setTimeout(() => {
                        loadCardImage(img, setData.setCode, card.number, card.name);
                    }, 50);
                }
            });
        }

        // Toggle variant collection status
        function toggleVariant(setKey, cardNumber, variant) {
            if (!collectionProgress[setKey][cardNumber]) {
                collectionProgress[setKey][cardNumber] = {};
            }
            collectionProgress[setKey][cardNumber][variant] = !collectionProgress[setKey][cardNumber][variant];
            saveProgress(collectionProgress);
            renderCards(setKey);
            updateProgress();
        }

        // Set switching
        document.querySelectorAll('.set-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const setKey = this.dataset.set;
                
                // Update button states
                document.querySelectorAll('.set-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                // Update visible sections
                document.querySelectorAll('.set-section').forEach(section => {
                    section.classList.remove('active');
                });
                const targetSection = document.getElementById(setKey);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            });
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const activeSet = document.querySelector('.set-section.active');
            const cards = activeSet.querySelectorAll('.card-item');

            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Export progress
        function exportProgress() {
            const report = [];
            Object.entries(cardSets).forEach(([setKey, setData]) => {
                let totalVariants = 0;
                let collectedVariants = 0;

                setData.cards.forEach(card => {
                    const variants = getVariants(card, setKey);
                    totalVariants += variants.length;
                    
                    if (collectionProgress[setKey][card.number]) {
                        collectedVariants += Object.values(collectionProgress[setKey][card.number]).filter(Boolean).length;
                    }
                });

                report.push(`${setData.name}: ${collectedVariants}/${totalVariants} variants (${Math.round(collectedVariants/totalVariants * 100)}%)`);
            });
            
            alert(`üìä Collection Progress Report üìä\n\n${report.join('\n')}`);
        }

        // Initialize
        Object.keys(cardSets).forEach(setKey => {
            renderCards(setKey);
        });
        updateProgress();
    </script>
</body>
</html>
